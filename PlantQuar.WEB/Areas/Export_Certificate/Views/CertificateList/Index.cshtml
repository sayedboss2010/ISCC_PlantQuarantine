
@{
    ViewBag.Title = "Certificate List";
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
}
@section Title{
    <h2 class="ls-top-header">طلبات الشهادة الزراعية(صادر)</h2>
}

@*@section Title{
        <h2 class="ls-top-header">@PlantQuar.WEB.Language.Resource_data1.CertificateList</h2>
    }

    @section Path{
        <li style="position: relative;right: 28px;">@PlantQuar.WEB.Language.Resource_data1.CertificateRequest</li>
        <li class="active" style="right: 43px; position: relative;">@PlantQuar.WEB.Language.Resource_data1.CertificateList</li>
    }*@

<style>
    th {
        font-size: 14px !important;
        text-align: center;
    }

    td {
        font-size: 12px !important;
        text-align: center;
    }

    .status {
        display: inline-block;
        margin: 20px 0px 20px 50px;
    }

    p {
        font-weight: bold;
    }

    #capq blockquote.styles {
        margin-bottom: 70px;
    }

    .btn-secondary {
        background-color: #1fb5ad;
    }

        .btn-secondary:not([disabled]):not(.disabled):active, .btn-secondary:not([disabled]):not(.disabled).active, .show > .btn-secondary.dropdown-toggle {
            color: #fff;
            background-color: #0c6265;
            border-color: #9ec7da;
            box-shadow: inset 0 3px 5px rgba(45, 101, 93, 0.125), 0 0 0 2px rgba(72, 145, 152, 0.5);
        }

        .btn-secondary:hover {
            background-color: #389da0;
            border-color: #7fc7d0;
        }

    .btn-group > .btn, .btn-group-vertical > .btn {
        width: 159px;
    }

    option:focus,
    option:hover {
        outline: none;
    }

    .label-primary {
        background-color: #3da4a7;
    }

    option {
        color: #379598 !important;
    }

    .table-bordered tbody tr:nth-child(odd) td {
        background-color: #42a9ad7a;
    }

    .table-bordered tbody tr:nth-child(even) td {
        background-color: #ceecf578;
    }

    .table-bordered tbody tr.highlight td {
        background-color: #F2F5A9;
    }

    .table-bordered tbody tr:hover {
        /*background-color: #86d8e6;
        color: black;
        font-weight: bold;*/
    }

    .table-bordered tbody tr {
        color: black;
        font-weight: bold;
    }

    .ch {
        list-style: none;
        margin: 0;
        padding: 0;
        overflow: auto;
        display: inline-block;
        bottom: 50px;
        position: relative;
    }

        .ch li {
            color: #545050;
            display: block;
            position: relative;
            float: right;
            /*width: 100%;*/
            height: 100px;
            /*border-bottom: 1px solid #333;*/
            /*display: inline-block*/
        }

            .ch li input[type=radio] {
                position: absolute;
                visibility: hidden;
            }

            .ch li label {
                display: block;
                position: relative;
                font-weight: 300;
                font-size: 15px;
                padding: 24px 36px 0px 55px;
                margin: 9px auto;
                height: 30px;
                z-index: 9;
                cursor: pointer;
                -webkit-transition: all 0.25s linear;
            }

            .ch li:hover label {
                color: #3da4a7;
            }

            .ch li .check {
                display: block;
                position: absolute;
                border: 5px solid #686664;
                border-radius: 100%;
                height: 25px;
                width: 25px;
                top: 30px;
                left: 20px;
                z-index: 5;
                transition: border .25s linear;
                -webkit-transition: border .25s linear;
            }

            .ch li:hover .check {
                border: 5px solid #3da4a7;
            }

            .ch li .check::before {
                display: block;
                position: absolute;
                content: '';
                border-radius: 100%;
                height: 10px;
                width: 9px;
                top: 2px;
                left: 3px;
                margin: auto;
                transition: background 0.25s linear;
                -webkit-transition: background 0.25s linear;
            }

    input[type=radio]:checked ~ .check {
        border: 5px solid #0c6265;
    }

        input[type=radio]:checked ~ .check::before {
            background: #0c6265;
        }

    input[type=radio]:checked ~ label {
        color: #0c6265;
    }

    .pagination > .active > a, .pagination > .active > span, .pagination > .active > a:hover, .pagination > .active > span:hover, .pagination > .active > a:focus, .pagination > .active > span:focus {
        z-index: 2;
        color: #ffffff;
        cursor: default;
        background-color: #257e80 !important;
        border-color: #1da8ab !important;
    }

    .pagination {
        right: 292px;
        position: relative;
    }



    a {
        color: #0032e6;
        text-decoration: none;
    }

    .test {
        color: #a52525 !important;
    }

    .table-bordered > thead > tr > th, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > tbody > tr > td, .table-bordered > tfoot > tr > td {
        border: 2px solid #000 !important;
    }

    .table-bordered tbody tr:nth-child(odd) td {
        background-color: #ececec;
    }

    .table-bordered tbody tr:nth-child(even) td {
        background-color: #31979a2e;
    }

    .table-bordered tbody tr.highlight td {
        background-color: #F2F5A9;
    }

    #stationcode {
        width: 100%;
        height: 3.573rem;
        margin-top: 8px;
    }

    .acceptt {
        margin-left: 10px !important;
        background-color: #3da4a7 !important;
        margin-right: 10px;
    }

    .notacceptt {
        background-color: #d60d0da8 !important;
        border-color: #d60d0da8 !important;
    }
</style>
<link href="~/assets/css/bootstrap-select.min.css" rel="stylesheet" />
<div>
    <div class="row">

        <div class="col-md-6">

            <div class="col-md-3">
                <label>@PlantQuar.WEB.Language.Resource_data1.RequestNumber</label>
            </div>
            <div class="col-md-9">
                <input type="text" id="requestNumber" class="form-control">

            </div>
        </div>
        <div class="col-md-6">
            <div class="col-md-3">
                <label>الحالة</label>

            </div>
            <div class="col-md-9">
                <select id="dd_ISAccepted" class="form-control">
                    <option value="2">@PlantQuar.WEB.Language.Resource_data1.chooseNew</option>
                    <option value="1">@PlantQuar.WEB.Language.Resource_data1.ChooseAccpeted</option>
                    <option value="0">@PlantQuar.WEB.Language.Resource_data1.ChooseNotAccpeted</option>
                </select>
            </div>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-6 ">
            <div class="col-md-3">
                <label for="Constrain_Country" class="control-label ">الدولة </label>
            </div>
            <div class="col-md-9">
                <select id="Country_List" class="form-control  Country_List"></select>
            </div>
        </div>
 
    </div>
  
    <br />
    <div class="row">
        <div class="col-md-6">
            <label class="col-md-3">نوع الجهة</label>
            <select name="types" id="typesList" class="form-control col-md-9">
                <option value="0">اختار</option>
                <option value="6">شركة</option>
                <option value="7">هيئة </option>
                <option value="8">فرد</option>

            </select>

        </div>
        <div class="col-md-6">
            <label class="col-md-3">اسم الشركة</label>

            <select id="Company_List" class="form-control  Company_List col-md-9"></select>
        </div>
    </div>

    @*<div class="row" id="lst_Company_Name">
            <div class="col-md-6">




            </div>
        </div>*@
    <br />
    <br />
    <div class="row">
        <div class="col-md-4"></div>
        <div class="col-md-4">

            <center>
                @*<button id="getcertificates" style="margin-top:10px;">Get</button>*@
                <input type="button" style="width:50%" class="btn btn-primary" id="getcertificates" value="@PlantQuar.WEB.Language.Resource_data1.Search" autocomplete="off">


            </center>

        </div>
        <div class="col-md-4"></div>
    </div>
    <br />
    <br />
    @*<input type="button" value="بحث"  id="btn_Approved"  name="btn_Approved" />*@
    <div id="checkRequest_lst" class="table-responsive">
        <table class="table table-bordered" id="tblCheckLst">
            <thead style="color:white !important;">
                <tr class="label-primary">
                    <th>@PlantQuar.WEB.Language.Resource_data1.ExportRequestNumber</th>
                    <th>رقم الشهادة</th>
                    <th>تاريخ الطلب</th>
                    <th> نوع الجهة</th>
                    <th>اسم الشركة</th>
                    <th>الدولة</th>

                    <th>@PlantQuar.WEB.Language.Resource_data1.Status</th>

                    <th>عرض</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <br />
    </div>

</div>
<script src="~/assets/js/bootstrap-select1.min.js"></script>
<script>

       $(function () {
        //Country_List
        $.ajax(
            {
                url: '@Url.Action("Country_List", "CertificateList", new { area = "Export_Certificate" })',
                type: 'Post',
                success: function (data) {
                    $('#Country_List').empty();
                   // $('#Company_List').empty();
                    $.each(data.Options, function (i, index) {
                        $('#Country_List').append($('<option />').val(index.Value).text(index.DisplayText));

                    }); //each
                    $('#Country_List').selectpicker('refresh');
                } //success
            });//ajax
        //Company_List
        @*$.ajax(
            {
                url: '@Url.Action("Company_List", "CertificateList", new { area = "Export_Certificate" })',
                type: 'Post',
                success: function (data) {
                    $('#Company_List').empty();
                    $.each(data.Options, function (i, index) {
                        $('#Company_List').append($('<option />').val(index.Value).text(index.DisplayText));
                    }); //each
                    $('#Company_List').selectpicker('refresh');
                } //success
            });//ajax*@

      });

       $(document).ready(function () {
        $("#Country_List, #Company_List").selectpicker({
            liveSearch: true

        });

       // App.init();
  });
       $(document).ready(function () {

        if ('@ViewBag.requestNumber' != null && '@ViewBag.requestNumber' !='') {
            $("#requestNumber").val('@ViewBag.requestNumber')
            //$('#Country_List').empty();
            $('#Company_List').empty();
            btn_Approved_Click();
        }

       });
    $('#typesList').on("change", function () {
        $('#Company_List').empty();

    var _Company_Type_Id = $('#typesList').val();
                 //   $('#Country_List').empty();
                   
               //alert(_Company_Type_Id);

    $.ajax(
            {

                url: '@Url.Action( "Company_Name_Pr", "CertificateList", new { area = "Export_Certificate" })',
                type: 'Post',
            data: { Company_Type_Id: _Company_Type_Id },
                success: function (data) {
                    $("#Company_List").empty();
                    $.each(data.Options, function (i, index) {
                        $('#Company_List').append($('<option />').val(index.Value).text(index.DisplayText));
                      
                    }); //each  
                    $('#Company_List').selectpicker('refresh');
                } //success
            });//ajax
   

});
       function btn_Approved_Click() {


        var requestNumber = $("#requestNumber").val();


           var html = '';

           var j = 0;

                $.getJSON('/Export_Certificate/CertificateList/getCertificateList',
                    {
                        //fromDate: fromDate,
                        //endDate: endDate,
                        ISAccepted: $("#dd_ISAccepted").val(),
                        Country_Id: $("#Country_List").val(),
                        Company_Id: $("#Company_List").val(),
                        companyTypes: $("#typesList").val(),


                        requestNumber: requestNumber
                    }, function (data, succ) {

                        $.each(data, function (i, item) {
                            var htmlData = '';

                            html += "<tr><td><a href='/Export_CheckRequest/EX_CheckRequestCertificate/Index?ExCheckRequest_Number=" + data[i].CheckRequest_Number + "&Outlet_ID='>"+ data[i].CheckRequest_Number+"</a></td>";


                            html += "<td><a href='/Export_Certificate/CertificateDetails/Index?certificate_ID=" + data[i].PlantCertificatesRequest_ID + "'>" + data[i].CertificateNumber +"</a></td>";

                            html += "<td>" + $.datepicker.formatDate('yy-mm-dd', (new Date(parseInt(data[i].User_Creation_Date.substr(6)))))  + "</td>";
                            if (data[i].ExporterTypeID == 6) {
                             
                                html += "<td>شركة</td>";
                            }
                            if (data[i].ExporterTypeID == 7) {
                                html += "<td>هيئة</td>";
                            }
                            if (data[i].ExporterTypeID == 8) {
                                html += "<td>فرد</td>";
                            }
                            else {
                                html += "<td>شركة</td>";
                            }
                     
                            html += "<td>" + data[i].Importer_Exporter_Name + "</td>";
                            html += "<td>" + data[i].ImportCountry_Name + "</td>";


                             if (data[i].ISAccepted == true) {

                                if (data[i].ISPrint == false) {
                                    if (data[i].IsPayment == true) {
                                        html += "<td><a href='/Export_Certificate/Certificate/Index?certificateId=" + data[i].PlantCertificatesRequest_ID
                                            + "&isPrint=true'>@PlantQuar.WEB.Language.Resource_data1.Print</a></td>";

                                    }
                                    else {

                                        html += "<td>لم يتم الدفع</td>"
                                    }

                                }
                                else {
                                    html += "<td><button id='trn_" + data[i].PlantCertificatesRequest_ID
                                        + "' class='print' data-id='" + data[i].PlantCertificatesRequest_ID
                                        + "'>إعادة طباعة</button>";

                                      /*  "<td><a href='/Export_Certificate/CertificateList/putprintCertificates?certificateId=" + data[i].PlantCertificatesRequest_ID + "'>إعادة طباعة</a>";*/
                                    html += "@PlantQuar.WEB.Language.Resource_data1.Printed </td>";
                                }

                            }
                            else if (data[i].ISAccepted == false) {
                                html += "<td>@PlantQuar.WEB.Language.Resource_data1.ChooseNotAccpeted</td>";
                            }
                             else {
                                 if (data[i].ISAccepted == true) {
                                     htmlData += " تم قبول الطلب";
                                     if (data[i].ISPrint == true) {
                                         htmlData += " تم الدفع ";
                                     }
                                     else {
                                         htmlData += "لم تم الدفع";
                                     }
                                 }
                                 else if (data[i].ISAccepted == false) {
                                     htmlData += " تم رفض الطلب";
                                 }
                                 else {
                                     htmlData += "لم يتم النظر";
                                 }

                                 html += "<td>" + htmlData + "</td>";
                                /*html += "<td><button id='tr_" + data[i].PlantCertificatesRequest_ID
                                    + "' class='acceptt' data-id='" + data[i].PlantCertificatesRequest_ID
                                    + "'>@PlantQuar.WEB.Language.Resource_data1.ChooseAccpeted</button><button id='trn_" + data[i].PlantCertificatesRequest_ID
                                    + "' class='notacceptt' data-id='" + data[i].PlantCertificatesRequest_ID
                                    + "'>@PlantQuar.WEB.Language.Resource_data1.ChooseNotAccpeted</button></td>";*/
                            }
                           /* if (data[i].IsPaid == false) {*/
                                html += "<td><a href='/Export_Certificate/Certificate/Index?certificateId=" + data[i].PlantCertificatesRequest_ID + "&isPrint=false'>@PlantQuar.WEB.Language.Resource_data1.view</a></td>";
                          /*  }*/
                            @*if (data[i].IsPaid == true) {
                                html += "<td><a href='/Export_Certificate/Certificate/Index?certificateId=" + data[i].PlantCertificatesRequest_ID + "&isPrint=true'>@PlantQuar.WEB.Language.Resource_data1.view</a></td>";
                            }
                            else {
                                html += "<td> لم يتم الدفع</td>";
                            }*@
                            html += "</tr>";
                        });
                        $("#tblCheckLst tbody").empty();
                        $("#tblCheckLst tbody").append(html);
                        $(".acceptt").click(function () {
                            var certificateId = $(this).data("id");
                            $.post('/CertificateList/acceptCertificate', { ID: certificateId }, function (data, succ) {
                                $("#tr_" + certificateId).text("accepted");
                                $("#tr_" + certificateId).css("color", "blue");
                            });
                        });
                        $(".notacceptt").click(function () {
                            var certificateId = $(this).data("id");
                            $.post('/CertificateList/NotAcceptCertificate', { ID: certificateId }, function (data, succ) {
                                $("#trn_" + certificateId).text("not accepted");
                                $("#trn_" + certificateId).css("color", "red");
                            });
                        });
                        $(".print").click(function () {
                            var certificateId = $(this).data("id");
                            $.post('/CertificateList/putprintCertificates', { ID: certificateId }, function (data, succ) {
                                $("#trn_" + certificateId).text("not accepted");
                                $("#trn_" + certificateId).css("color", "red");
                            });
                            location.reload(true);
                        });
                        //$(".print").click(function () {
                        //    var certificateId = $(this).data("id");
                        //    $.post('/CertificateList/putprintCertificates', { ID: certificateId }, function (data, succ) {
                        //        $("#trn_" + certificateId).text("not accepted");
                        //        $("#trn_" + certificateId).css("color", "red");
                        //    });
                        //});
                    });
        }
        //dd_ISAccepted
        $('#getcertificates').click(function () {

            btn_Approved_Click();
        });

        $('#dd_ISAccepted').change(function () {
            //$("#typesList").empty();
            //alert(1)
       
            //$("#Country_List").empty();
           // $("#Country_List").empty();
            btn_Approved_Click();
        });
        function convert(str) {

            var date = new Date(str),
                mnth = ("0" + (date.getMonth() + 1)).slice(-2),
                day = ("0" + date.getDate()).slice(-2);
            return [date.getFullYear(), mnth, day].join("-");
        }
</script>