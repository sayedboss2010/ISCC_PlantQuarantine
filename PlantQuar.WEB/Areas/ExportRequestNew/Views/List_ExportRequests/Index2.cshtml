@model PagedList.IPagedList<PlantQuar.DTO.DTO.ExportRequest.CustomeEx_RequestList_Admin>
@using PagedList.Mvc;


<link href="/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = @PlantQuar.WEB.Language.Resource_data1.ExportRequestsList;
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
    var model = Model;
}

@section Title{
    <h2 class="ls-top-header">@PlantQuar.WEB.Language.Resource_data1.ExportRequestsList</h2>
}

@section Path{
    <li style="position: relative;right: 28px;">فحص</li>
    <li class="active" style="right: 43px; position: relative;">@PlantQuar.WEB.Language.Resource_data1.ExportRequestsList</li>
}

<style>
    th {
        font-size: 14px !important;
        text-align: center;
    }

    td {
        font-size: 16px !important;
        text-align: center;
        font-family: "Times New Roman", Times, serif !important;
    }

    .status {
        display: inline-block;
        margin: 20px 0px 20px 50px;
    }

    p {
        font-weight: bold;
    }

    #capq blockquote.styles {
        margin-bottom: 70px;
    }

    .btn-secondary {
        background-color: #1fb5ad;
    }

        .btn-secondary:not([disabled]):not(.disabled):active, .btn-secondary:not([disabled]):not(.disabled).active, .show > .btn-secondary.dropdown-toggle {
            color: #fff;
            background-color: #0c6265;
            border-color: #9ec7da;
            box-shadow: inset 0 3px 5px rgba(45, 101, 93, 0.125), 0 0 0 2px rgba(72, 145, 152, 0.5);
        }

        .btn-secondary:hover {
            background-color: #389da0;
            border-color: #7fc7d0;
        }

    .btn-group > .btn, .btn-group-vertical > .btn {
        width: 159px;
    }

    option:focus,
    option:hover {
        outline: none;
    }

    .label-primary {
        background-color: #6dcac2
    }

    option {
        color: #379598 !important;
    }

    .table-bordered tbody tr:nth-child(odd) td {
        background-color: #ececec;
    }

    .table-bordered tbody tr:nth-child(even) td {
        /*background-color: #31979a2e;*/
    }

    .table-bordered tbody tr.highlight td {
        background-color: #F2F5A9;
    }

    /*.table-bordered tbody tr:hover {
            background-color: #86d8e6;
            color: black;
            font-weight: bold;
        }*/

    .ch {
        list-style: none;
        margin: 0;
        padding: 0;
        overflow: auto;
        display: inline-block;
        bottom: 50px;
        position: relative;
    }

        .ch li {
            color: #545050;
            display: block;
            position: relative;
            float: right;
            /*width: 100%;*/
            height: 100px;
            /*border-bottom: 1px solid #333;*/
            /*display: inline-block*/
        }

            .ch li input[type=radio] {
                position: absolute;
                visibility: hidden;
            }

            .ch li label {
                display: block;
                position: relative;
                font-weight: 300;
                font-size: 15px;
                padding: 24px 36px 0px 55px;
                margin: 9px auto;
                height: 30px;
                z-index: 9;
                cursor: pointer;
                -webkit-transition: all 0.25s linear;
            }

            .ch li:hover label {
                color: #3da4a7;
            }

            .ch li .check {
                display: block;
                position: absolute;
                border: 5px solid #686664;
                border-radius: 100%;
                height: 25px;
                width: 25px;
                top: 30px;
                left: 20px;
                z-index: 5;
                transition: border .25s linear;
                -webkit-transition: border .25s linear;
            }

            .ch li:hover .check {
                border: 5px solid #3da4a7;
            }

            .ch li .check::before {
                display: block;
                position: absolute;
                content: '';
                border-radius: 100%;
                height: 10px;
                width: 9px;
                top: 2px;
                left: 3px;
                margin: auto;
                transition: background 0.25s linear;
                -webkit-transition: background 0.25s linear;
            }

    input[type=radio]:checked ~ .check {
        border: 5px solid #0c6265;
    }

        input[type=radio]:checked ~ .check::before {
            background: #0c6265;
        }

    input[type=radio]:checked ~ label {
        color: #0c6265;
    }

    .pagination > .active > a, .pagination > .active > span, .pagination > .active > a:hover, .pagination > .active > span:hover, .pagination > .active > a:focus, .pagination > .active > span:focus {
        z-index: 2;
        color: #ffffff;
        cursor: default;
        background-color: #257e80 !important;
        border-color: #1da8ab !important;
    }

    .pagination {
        right: 292px;
        position: relative;
    }

    select.form-control:not([size]):not([multiple]) {
        height: 3.573rem;
        margin-top: 8px;
    }

    a {
        color: #0032e6;
        text-decoration: none;
    }

    .test {
        color: #a52525 !important;
    }

    .table-bordered > thead > tr > th, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > tbody > tr > td, .table-bordered > tfoot > tr > td {
        border: 2px solid #000 !important;
    }

    #checkRequest_lst {
        display: block;
        width: 111%;
        overflow-x: auto;
        left: 49px;
        position: relative;
    }

    #btn_Approved {
        margin-bottom: 10px;
        width: 40%;
        float: left;
        color: white;
    }

    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
        padding: 3px !important;
    }
</style>
<div class="row" style="bottom: 40px;position: relative;width:100%">
    <div class="col-md-4 col-sm-12">
        <div>
            <p style="font-weight:bold">@PlantQuar.WEB.Language.Resource_data1.CommitteeStatus</p>
        </div>
        <select id="selectApprove" class="form-control">
            <option id="rdoApprovedAll" value="choose">@PlantQuar.WEB.Language.Resource_data1.choose</option>
            <option id="rdoApprovedAll" value="-1">@PlantQuar.WEB.Language.Resource_data1.chooseall</option>           
            <option id="rdoApproved" value="1">@PlantQuar.WEB.Language.Resource_data1.newrequests</option>
            <option id="rdoApprovedNot" value="0">@PlantQuar.WEB.Language.Resource_data1.AcceptedByQuarantine</option>
            <option id="rdoApprovedNot2" value="-2">@PlantQuar.WEB.Language.Resource_data1.RejectedByQuarantine</option>
            <option id="rdoApprovedNot2" value="-3">@PlantQuar.WEB.Language.Resource_data1.CommitteeIsFormed</option>
            <option id="rdoApprovedNot2" value="3">@PlantQuar.WEB.Language.Resource_data1.AcceptedByCustomer </option>
            <option id="rdoApprovedNot2" value="4">@PlantQuar.WEB.Language.Resource_data1.RejectedByCustomer </option>
            <option id="rdoApprovedNot2" value="-4">@PlantQuar.WEB.Language.Resource_data1.WorkCommitteeIsFinished </option>
        </select>
    </div>    
    <div class="col-md-4  col-sm-12">
        <div>
            <p style="font-weight:bold">@PlantQuar.WEB.Language.Resource_data1.RequestNumber</p>
        </div>
        <input type="text" id="requestnumber" style="width: 100%;margin-top: 10px;">        
    </div>    
    <div class="col-md-4  col-sm-12">
        <p style="font-weight:bold; margin-bottom:0px">@PlantQuar.WEB.Language.Resource_data1.CommitteeType</p>
        @Html.DropDownList("CommitteeType_ID", "_")
    </div>
</div>
<div class="row">
   <div class="col-md-8"></div>
</div>
<div id="checkRequest_lst" class="table-responsive">
    <table class="table table-bordered col-md-12" id="tblCheckLst">
        <thead>
            <tr class="label-primary">
                <th>م</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.RequestNumber</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.ExporterType </th>
                <th>@PlantQuar.WEB.Language.Resource_data1.ExporterSide </th>
                <th>@PlantQuar.WEB.Language.Resource_data1.CountryExport</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.Governate</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.Outlet</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.RequestDate</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.CommitteeType</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.Details </th>
                <th>@PlantQuar.WEB.Language.Resource_data1.Status  </th>
                <th>@PlantQuar.WEB.Language.Resource_data1.Consignmentresults</th>
                <th>@PlantQuar.WEB.Language.Resource_data1.CommitteeFormation</th>
                @*<th>إصدار شهادة</th>*@
            </tr>
        </thead>
        <tbody>
            @if (model != null)
            {
                foreach (var item in model)
                {
                    //var CertificateDisabled = item.IsAcceppted == false ? "disabled" : "";

                    <tr>
                        <td>
                            @Html.DisplayFor(m => item.Row_Id)
                        </td>
                        <td>
                            @Html.DisplayFor(m => item.CheckRequest_Number)
                        </td>
                        <td>
                            @Html.DisplayFor(m => item.ExporterType_Name)
                        </td>
                        <td>
                            @Html.DisplayFor(m => item.Exporter_Name)
                        </td>
                        <td>
                            @Html.DisplayFor(m => item.ImportCountry_Name)
                        </td>
                        <td>
                            @Html.DisplayFor(m => item.Govern_Name)
                        </td>
                        <td>
                            @Html.DisplayFor(m => item.Outlet_Name)
                        </td>
                        <td>
                            @Convert.ToString(string.Format("{0:dd/MM/yyyy}", item.Ex_Creation_Date))
                            @*@{
                                       var accept = @item.IsAcceppted == false ? "لم يتم الموافقة" : "تم الموافقة";
                                    <p>  @accept</p>
                                }*@
                        </td>

                        @if (item.Committe_TypeName == null)
                        {
                            <td>
                                ----
                            </td>
                        }
                        else
                        {
                            <td>
                                @Html.DisplayFor(m => item.Committe_TypeName)
                            </td>
                        }

                        <td>
                            @Html.ActionLink(@PlantQuar.WEB.Language.Resource_data1.Details, "getRequestData", "List_ExportRequests", new { reqId = item.CheckRequest_Id }, null)
                        </td>
                        @if (item.IsPaid == true)
                        {
                            if (item.IsAcceppted == true)
                            {
                                if (item.Committe_Status == null)
                                {
                                    <td>
                                        @Html.ActionLink(@PlantQuar.WEB.Language.Resource_data1.CommitteeFormation, "createCommittee", "List_ExportRequests", new { reqId = item.CheckRequest_Id, committeeId = item.CommitteID }, null)

                                    </td>
                                }
                                else if (item.Committe_Status == false)
                                {
                                    if (item.Committe_IsApproved == null)
                                    {
                                        <td>---</td>
                                    }
                                    else if (item.Committe_IsApproved == true)
                                    {
                                        <td>@PlantQuar.WEB.Language.Resource_data1.committeeapproved</td>
                                    }
                                    else
                                    {
                                        <td>
                                            @Html.ActionLink(@PlantQuar.WEB.Language.Resource_data1.CommitteeFormation, "createCommittee", "List_ExportRequests", new { reqId = item.CheckRequest_Id, committeeId = item.CommitteID }, null)

                                        </td>
                                    }
                                }
                                else
                                {
                                    <td>@PlantQuar.WEB.Language.Resource_data1.committeeWorkEnded</td>
                                }

                            }
                            else
                            {
                                <td>@PlantQuar.WEB.Language.Resource_data1.requestrejected</td>
                            }

                        }
                        else if (item.IsPaid == false)
                        {

                            <td>
                                @Html.ActionLink(@PlantQuar.WEB.Language.Resource_data1.PayExpenses, "payFees", "List_ExportRequests", new { reqId = item.CheckRequest_Id }, null)

                            </td>
                        }
                    </tr>
                }
            }
        </tbody>
    </table>
    <br />
    @if (model != null)
    {
        @Html.PagedListPager(model, page => Url.Action("Index", new { page }))
    }
</div>
<script>
    $("#CommitteeType_ID").addClass("form-control")

    $("#CommitteeType_ID").on('change', function () {
        $("#tblCheckLst tbody").empty();
        if ($('#selectApprove').val() != 'choose') {
            btn_Approved_Click();
        } else {
            alert("@PlantQuar.WEB.Language.Resource_data1.ChooseStatusofCommittee")
        }

    });

    $(function () {
        sessionStorage.rdoApprovedAll = $("#rdoApprovedAll").attr('value');

        //sessionStorage.rdoOnlineOffline = $("#rdoOnlineOffline").attr('value');
        //sessionStorage.requestnumber = $("#requestnumber").attr('value');

        $('#selectApprove').change(function () {
            sessionStorage.rdoApprovedAll = $('#selectApprove').val();
            localStorage.selectApproveVal = $('#selectApprove').val();

            //choose
            $("#tblCheckLst tbody").empty();
            if ($('#selectApprove').val() != 'choose') {
                btn_Approved_Click();
            } else {
                alert("@PlantQuar.WEB.Language.Resource_data1.ChooseStatusofCommittee");
            }


        });

        $("#selectApprove").val(localStorage.selectApproveVal);
        if (window.event) {
            //alert(localStorage.selectApproveVal);
            $("#tblCheckLst tbody").empty();
            btn_Approved_Click();
        }
        else {
            btn_Approved_Click(1);
        }

        $('#btn_Approved').click(function () {

            $("#tblCheckLst tbody").empty();
            if ($('#selectApprove').val() != 'choose') {
                btn_Approved_Click();
            } else {
                alert("@PlantQuar.WEB.Language.Resource_data1.ChooseStatusofCommittee");
            }


        });
        $('#requestnumber').keyup(function () {

            $("#tblCheckLst tbody").empty();
            if ($('#selectApprove').val() != 'choose') {
                btn_Approved_Click();
            } else {
                alert("@PlantQuar.WEB.Language.Resource_data1.ChooseStatusofCommittee");
            }


        });
        //$("#rdoApprovedAll , #rdoApproved , #rdoApprovedNot , #rdoApprovedNot2").click(function () {
        //    sessionStorage.rdoApprovedAll = $(this).attr('value');
        //    btn_Approved_Click();
        //});

        $('#selectStatus').change(function () {
            sessionStorage.rdoOnlineOffline = $('#selectStatus').val();
            btn_Approved_Click();
        });

        //$("#rdoOnlineOffline , #rdoOnline , #rdoOffline ").click(function () {
        //    sessionStorage.rdoOnlineOffline = $(this).attr('value');
        //    btn_Approved_Click();
        //});
        btn_Approved_Click(1);
    });
    function btn_Approved_Click(selectStatus_default=0) {
       
      //  var radioValue = sessionStorage.rdoApprovedAll;
        var radioValue = localStorage.selectApproveVal;
        //var IS_OnlineOffline = sessionStorage.rdoOnlineOffline;
        var requestnumber = $("#requestnumber").val();
        var CommitteeType_ID = $("#CommitteeType_ID").val();
        if (CommitteeType_ID == null || CommitteeType_ID == "") {
            CommitteeType_ID = -1;
        }
        if (selectStatus_default == 1)
        {
            radioValue = 1;
            $('#selectApprove').val(1);
        }
        alert(radioValue);
        $.ajax(
            {
                url: '/List_ExportRequests/Export_CheckRequest_IsApproved?CommitteeType_ID=' + CommitteeType_ID + '&IsApproved=' + radioValue
                    + '&requestnumber=' + requestnumber,
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    var html = '';
                    var CheckRequest_Id = 0;
                    var Committe_TypeName = "";
                    var rquest_status = "";

                    $.each(data.Records, function (index, row) {
                        CheckRequest_Id = row.CheckRequest_Id;
                        if (row.Request_Status == 0) {
                            rquest_status = "not accepted";
                        } else if (row.Request_Status == 1) {
                            rquest_status = "Accepted";
                        } else if (row.Request_Status == 2) {
                            rquest_status = "stopped";
                        } else if (row.Request_Status == 3) {
                            rquest_status = "Refused";
                        }

                        if (row.Committe_TypeName == null) {
                            Committe_TypeName = "----";
                        } else {
                            Committe_TypeName = row.Committe_TypeName;
                        }
                        if (row.Committe_Status == true && row.IsFinishedAll == true && row.Committe_Type_Id == 2) {
                            html += "<tr id='CheckRequest_" + CheckRequest_Id + "'><td>" + row.Row_Id + "</td><td><a href='/Export_Certificate/CertificateList/Index?requestNumber=" + row.CheckRequest_Number + "'>" + row.CheckRequest_Number + "</a></td> <td>" + row.ExporterType_Name + "</td><td>" + row.Exporter_Name + "</td>"

                        } else {
                            html += "<tr id='CheckRequest_" + CheckRequest_Id + "'><td>" + row.Row_Id + "</td><td>" + row.CheckRequest_Number + "</td> <td>" + row.ExporterType_Name + "</td><td>" + row.Exporter_Name + "</td>"
                        }
                        html += "<td>" + row.ImportCountry_Name + "</td> <td > " + row.Govern_Name + "</td><td>" + row.Outlet_Name + "</td><td>" +
                            $.datepicker.formatDate('yy-mm-dd', (new Date(parseInt(row.Ex_Creation_Date.substr(6)))))
                        if (radioValue != "1") {                            
                        }
                        html += "</td><td>" + Committe_TypeName + "</td><td><a href='/ExportRequest/List_ExportRequests/getRequestData?reqId=" + CheckRequest_Id + "' >@PlantQuar.WEB.Language.Resource_data1.Details </a>";
                        html += "</td><td>" + rquest_status + "</td>"
                        html += "</td><td><a href='/ExportRequest/exportRequestCommitteeResult/Index?requestId=" + CheckRequest_Id + "' >@PlantQuar.WEB.Language.Resource_data1.Consignmentresults </a></td>";
                        if (row.IsPaid == true) {

                            if (row.IsAcceppted == true) {
                                if (row.Committe_Status == null) {
                                    html += "<td><a href='/ExportRequest/List_ExportRequests/createCommittee?reqId=" + CheckRequest_Id + "&committeeId=" + row.CommitteID + "&Committe_Type_Id=" + row.Committe_Type_Id + "' >@PlantQuar.WEB.Language.Resource_data1.CommitteeFormation </a></td>";
                                }
                                else if (row.Committe_Status == false) {

                                    if (row.Committe_IsApproved == null) {
                                        html += "<td>@PlantQuar.WEB.Language.Resource_data1.Waitingcustomerresponse</td>";
                                    } else if (row.Committe_IsApproved == true) {
                                        html += "<td>@PlantQuar.WEB.Language.Resource_data1.committeeapproved</td>";
                                    } else {
                                        //removed
                                        //html += "<td><a href='/ExportRequest/List_ExportRequests/createCommittee?reqId=" + CheckRequest_Id + "&committeeId=" + row.CommitteID + "' >تشكيل لجنة </a></td>";
                                        html += "<td>@PlantQuar.WEB.Language.Resource_data1.Reject</td>"
                                    }
                                }
                                else {

                                    if (row.IsFinishedAll == true) {

                                        if (row.CanalterGashny == true && row.Committe_Type_Id == 1) {

                                            //جيشني
                                            html += "<td>@PlantQuar.WEB.Language.Resource_data1.CheckCommitteeWorkEnded<br><a href='/ExportRequest/List_ExportRequests/createCommittee?reqId=" + CheckRequest_Id + "&committeeId=-1&Committe_Type_Id=2'>@PlantQuar.WEB.Language.Resource_data1.CommitteeFormationGashny </a></td>"


                                        } else {
                                            html += "<td>@PlantQuar.WEB.Language.Resource_data1.WorkEnded  " + Committe_TypeName + " </td>"
                                        }

                                    } else {
                                        html += "<td><a href='/ExportRequest/List_ExportRequests/createCommittee?reqId=" + CheckRequest_Id + "&committeeId=-1&Committe_Type_Id=" + row.Committe_Type_Id + "' >@PlantQuar.WEB.Language.Resource_data1.CommitteeFormation </a></td>";
                                        //committee type id
                                        // تشكيل نفس اللجنه
                                    }

                                }
                            }
                            else if (row.IsAcceppted == false)
                            {
                                html += "<td>@PlantQuar.WEB.Language.Resource_data1.requestrejected</td>"
                            }
else {
                                html += "<td>@PlantQuar.WEB.Language.Resource_data1.requestnotapproved</td>"
                            }
                        }
                        else if (row.IsPaid == false) {
                            html += "<td><a href='/ExportRequest/List_ExportRequests/payFees?reqId=" + CheckRequest_Id + "' class = 'test'>@PlantQuar.WEB.Language.Resource_data1.PayExpenses </a></td>";
                        }

                        //html += "<td><a href='/ExportRequest/List_ExportRequests/generateCertificate?reqId=" + CheckRequest_Id + "' >إصدار شهادة </a></td></tr> ";
                    })
                    $("#tblCheckLst tbody").empty();
                    $("#tblCheckLst tbody").append(html);
                }
            });
    }
    function Export_CheckRequest_UpdateStatus(CommitteID, CheckRequest_Id) {

        $.ajax(
            {
                url: 'Export_CheckRequest_UpdateStatus?CommitteID=' + CommitteID,
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    var html = '';
                    $("#CheckRequest_" + CheckRequest_Id).hide();
                    alert("@PlantQuar.WEB.Language.Resource_data1.committeAccepted");
                }

            });
    }
</script>
